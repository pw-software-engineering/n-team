@using Client_Module.ViewsTagID.Search;
@model HotelOfferDetailsModel;
@{
    ViewData["Title"] = "Offer details";
    HotelOfferDetailsTagID tagIDs = new HotelOfferDetailsTagID();
}

<div class="w-100 shadow-border bg-light p-4" id="@tagIDs.LoadingDataDivID">
    <img class="d-block mx-auto" style="width: 75px" src="~/resources/loading.gif" />
    <p class="text-center h5 mt-2">Loading hotel offer data...</p>
</div>

<div class="w-100 shadow-border bg-light p-4 d-none" id="@tagIDs.MainContentDivID">
    <div class="text-center">
        <h1 class="display-5 font-italic" style="font-weight: 400" id="@tagIDs.OfferTitleTextID"></h1>
    </div>
    <hr />
    <div class="mx-auto my-4 border-0 rounded picture-carousel-display shadow-border">
        <div class="d-flex flex-row h-100">
            <div class="flex-grow-0 h-100">
                <button class="btn btn-secondary h-100 rounded-right-0 p-0" style="width: 35px;" id="@tagIDs.PreviousCarouselPictureBtnID"><i class="fas fa-2x fa-chevron-left"></i></button>
            </div>
            <div class="flex-grow-1 h-100 bg-light">
                <img class="d-block mx-auto carousel-picture" id="@tagIDs.CarouselPictureImgID"/>
            </div>
            <div class="flex-grow-0 h-100">
                <button class="btn btn-secondary h-100 rounded-left-0 p-0" style="width: 35px" id="@tagIDs.NextCarouselPictureBtnID"><i class="fas fa-2x fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
    <hr />
    <div class="text-center">
        <h1 class="font-weight-light">Offer description</h1>
    </div>
    <p class="m-0 px-4 mt-4 text-justify" id="@tagIDs.OfferDescriptionTextID"></p>
    <br />
    <br />
    <p class="flex-grow-1 mb-2 text-align-center" style="font-size: 19px">
        <b class="mx-1">Max. number of guests: </b>
        <span class="mx-1" id="@tagIDs.MaxGuestsTextID"></span>
    </p>
    <ul class="mt-2 p-0" style="list-style-type: none; font-size: 20px">
        <li class="m-2 text-align-center">
            <i class="fas fa-user-tie mx-2"></i>
            <span class="m-0"><span style="color: gray">Adults:</span><span class="mx-3" id="@tagIDs.CostPerAdultTextID"></span></span>
        </li>
        <li class="m-2 text-align-center">
            <i class="fas fa-child mx-2"></i>
            <span class="m-0"><span style="color: gray">Children:</span><span class="mx-3" id="@tagIDs.CostPerChildTextID"></span></span>
        </li>
    </ul>
    <hr class="my-3" />
    <p class="text-center" style="font-size: 18px" id="@tagIDs.OfferStatusBoxID">
        <span style="font-weight: 500">Offer status:</span>
    </p>
    <button class="d-block mx-auto w-50 mt-2 mb-4 btn btn-success shadow-border font-weight-bold" data-toggle="modal" data-target="#reservationModal" style="font-size: 18px" id="@tagIDs.CreateReservationBtnID">
        <span>Create reservation</span>
        <i class="ml-2 fas fa-chevron-right"></i>
    </button>
    <hr class="my-3" />
    <div class="text-center">
        <h1 class="font-weight-light">Offer reviews</h1>
    </div>

    <ul class="pagination justify-content-center my-3">
        <li class="page-item">
            <a class="page-link" href="" aria-label="Previous">
                <i class="fas fa-chevron-left text-dark"></i>
            </a>
        </li>
        <li class="page-item">
            <input class="page-link text-dark text-center font-weight-bold p-2" style="width: 60px" type="number" min="1" value="1" />
        </li>
        <li class="page-item">
            <a class="page-link" href="" aria-label="Next">
                <i class="fas fa-chevron-right text-dark"></i>
            </a>
        </li>
    </ul>

    <ul class="list-unstyled offer-reviews-list w-75 m-0 py-2 mx-auto">

    </ul>

    <ul class="pagination justify-content-center mx-auto w-75 my-3">
        <li class="page-item ml-auto">
            <a class="page-link" href="" aria-label="Previous">
                <i class="fas fa-chevron-left text-dark"></i>
            </a>
        </li>
        <li class="page-item">
            <input class="page-link text-dark text-center font-weight-bold p-2" style="width: 60px" type="number" min="1" value="1" />
        </li>
        <li class="page-item">
            <a class="page-link" href="" aria-label="Next">
                <i class="fas fa-chevron-right text-dark"></i>
            </a>
        </li>
    </ul>
</div>

<div class="modal fade bd-example-modal-lg" id="reservationModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <button type="button" class="close p-2 px-3" data-dismiss="modal">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body py-0">
                <h3 class="font-weight-normal text-center mt-3 mb-1">Offer availability</h3>
                <small class="text-muted d-block w-75 mx-auto text-center mb-3">You can make a reservation for a period of time within the range of any time interval below</small>
                <ul class="list-unstyled text-center offer-availability-list">
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                    <li class="offer-availability-list-item p-2">20.09.2020<span class="text-secondary mx-3">&mdash;</span>23.10.2020</li>
                </ul>

                <hr />
                <h3 class="font-weight-normal text-center mb-3">Choose reservation period</h3>
                <div class="d-flex flex-row flex-wrap">
                    <div class="flex-grow-1 mx-3">
                        <p class="text-muted my-0 mx-2">From:</p>
                        <input class="form-control flex-grow-1 w-100" type="date" />
                    </div>
                    <div class="flex-grow-1 mx-3">
                        <p class="text-muted my-0 mx-2">To:</p>
                        <input class="form-control flex-grow-1 w-100" type="date" />
                    </div>
                </div>
                <hr />
                <button class="d-block btn btn-success w-50 mx-auto my-4 font-weight-bold" style="font-size: 18px; min-width: 150px">Create reservation</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script src="~/js/Search/HotelOfferDetails/hotelOfferDetailsManager.js"></script>
<script src="~/js/Shared/carouselPicturesManager.js"></script>
<script>
    (function () {
        var apiConfig = {
            apiBaseUrl: "@ServerApiConfig.BaseUrl",
            apiTokenCookieName: "@ClientTokenCookieDefaults.AuthCookieName",
            apiTokenHeaderName: "@ServerApiConfig.TokenHeaderName"
        };
        var hotelOfferDetailsManager = new HotelOfferDetailsManager({
            hotelID: @Model.HotelID,
            offerID: @Model.OfferID,
            apiConfig: apiConfig
        });

        var carouselPicturesManager = new CarouselPictureManager($("#@tagIDs.CarouselPictureImgID"));
        $("#@tagIDs.NextCarouselPictureBtnID").on('click', function () {
            carouselPicturesManager.showNextPicture();
        });
        $("#@tagIDs.PreviousCarouselPictureBtnID").on('click', function () {
            carouselPicturesManager.showPreviousPicture();
        });

        (async function () {
            try {
                var data = await hotelOfferDetailsManager.getHotelOfferDetails();
            } catch (error) {
                var loadingDataDiv = $("#@tagIDs.LoadingDataDivID");
                loadingDataDiv.empty();
                loadingDataDiv.append(
                    $("<p>").attr("class", "text-center text-danger h3").text("Error"),
                    $("<p>").attr("class", "text-center text-danger h5").text(error.message)
                );
                $("#@tagIDs.MainContentDivID").remove();
                return;
            }
            $("#@tagIDs.OfferTitleTextID").text(data.offerTitle);
            $("#@tagIDs.OfferDescriptionTextID").text(data.offerDescription);
            $("#@tagIDs.MaxGuestsTextID").text(data.maxGuests);

            var numberFormatterOptions = {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            };
            $("#@tagIDs.CostPerAdultTextID").text(`${Number(data.costPerAdult).toLocaleString('en-US', numberFormatterOptions)} zł / adult`);
            $("#@tagIDs.CostPerChildTextID").text(`${Number(data.costPerChild).toLocaleString('en-US', numberFormatterOptions)} zł / child`);

            var offerStatusBox = $("#@tagIDs.OfferStatusBoxID");
            if (data.isActive === true) {
                offerStatusBox.append(
                    $('<i class="far fa-check-circle mx-1" style="color: green">'),
                    $("<span>").attr("class", "text-success").text("Active"),
                    $("<br>"),
                    $("<span>").attr("class", "text-secondary").text("Press the button below and book a room!")
                );
            } else {
                $("#@tagIDs.CreateReservationBtnID").remove();
                if (data.isDeleted === false) {
                    offerStatusBox.append(
                        $('<i class="far fa-pause-circle text-warning mx-1">'),
                        $("<span>").attr("class", "text-warning").text("Inactive"),
                        $("<br>"),
                        $("<span>").attr("class", "text-secondary").text("This offer has been deactivated. Please wait for activation in order to create a reservation.")
                    );
                } else {
                    offerStatusBox.append(
                        $('<i class="fas fa-ban text-danger mx-1">'),
                        $("<span>").attr("class", "text-danger").text("Deleted"),
                        $("<br>"),
                        $("<span>").attr("class", "text-secondary").text("This offer has been deleted. You cannot make a reservation for this offer but feel free to read the reviews below!")
                    );
                }
            }

            carouselPicturesManager.pictures = data.offerPictures;

            $("#@tagIDs.LoadingDataDivID").addClass("d-none");
            $("#@tagIDs.MainContentDivID").removeClass("d-none");
        })();
    })();
</script>
    <script>
        // data-backdrop="static"

        //var modalJQ = $("#reservationModal");
        //// Disallow closing modal window by clicking anywhere outside
        //var lockModal = true;

        //function ShowReservationModal() {
        //    modalJQ.modal("show");
        //}

        //function HideReservationModal() {
        //    // Unlock modal, as immidiatelly after this function returns, a "hide" event will be fires
        //    lockModal = false;
        //    modalJQ.modal("hide");
        //}

        //modalJQ.on("hide.bs.modal", function (e) {
        //    if (lockModal) {
        //        e.preventDefault();
        //    }
        //    // if HideReservationModal was fired, reset lockModal back to true
        //    lockModal = true;
        //});
    </script>
}
